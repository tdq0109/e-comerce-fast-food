@model ASM.Models.Order

@{
    ViewData["Title"] = "Chi tiết Đơn hàng";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<h2>@ViewData["Title"]</h2>
<hr />

<div class="card">
    <div class="card-header">
        <h3>Đơn hàng #@Model.OrderID</h3>
    </div>
    <div class="card-body">
        <dl class="row">
            <dt class="col-sm-3">Ngày đặt hàng</dt>
            <dd class="col-sm-9">@Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</dd>

            <dt class="col-sm-3">Trạng thái</dt>
            <dd class="col-sm-9">@Model.Status</dd>

            <dt class="col-sm-3">Địa chỉ giao hàng</dt>
            <dd class="col-sm-9">@Model.DeliveryAddress</dd>

            <dt class="col-sm-3">Tổng tiền</dt>
            <dd class="col-sm-9">@Model.TotalAmount.ToString("N0") đ</dd>

            <dt class="col-sm-3">Lý do hủy (nếu có)</dt>
            <dd class="col-sm-9">@(!string.IsNullOrEmpty(Model.CancelReason) ? Model.CancelReason : "-")</dd>

            <dt class="col-sm-3">Ghi chú</dt>
            <dd class="col-sm-9">@(!string.IsNullOrEmpty(Model.Note) ? Model.Note : "-")</dd>

            <dt class="col-sm-3">Khách hàng</dt>
            <dd class="col-sm-9">
                @if (Model.User != null)
                {
                    @Model.User.FullName <br />
                    @Model.User.Email <br />
                    @Model.User.Phone
                }
                else
                {
                    <span>Không có thông tin khách hàng</span>
                }
            </dd>
        </dl>

        <h4>Chi tiết đơn hàng</h4>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Tên sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Giá</th>
                    <th>Thành tiền</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.OrderDetails != null && Model.OrderDetails.Any())
                {
                    foreach (var item in Model.OrderDetails)
                    {
                        <tr>
                            <td>
                                @(
                                    item.Product != null ? item.Product.ProductName :
                                    item.Combo != null ? item.Combo.ComboName :
                                    "Không có tên"
                                    )
                            </td>
                            <td>@item.Quantity</td>
                            <td>
                                @(
                                    item.Product != null ? item.UnitPrice.ToString("N0") + " VNĐ" :
                                    item.Combo != null ? item.UnitPrice.ToString("N0") + " VNĐ" :
                                    "-"
                                    )
                            </td>
                            <td>@(item.Quantity * item.UnitPrice) VNĐ</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="text-center">Không có sản phẩm trong đơn hàng</td>
                    </tr>
                }
            </tbody>

        </table>
    </div>
    <div class="card-footer">
        <a asp-area="Admin" asp-controller="Order" asp-action="Index" class="btn btn-secondary">Quay lại</a>
        <a asp-area="Admin" asp-controller="Order" asp-action="Edit" asp-route-id="@Model.OrderID" class="btn btn-primary">Sửa trạng thái</a>
    </div>
</div>

